#!/usr/bin/env python
import argparse
from datetime import datetime
from monthdelta import monthmod


def add_years(start_date: datetime, years: int):
    try:
        return start_date.replace(year=start_date.year + years)
    except ValueError:
        # ğŸ‘‡ï¸ preseve calendar day (if Feb 29th doesn't exist, set to 28th)
        return start_date.replace(year=start_date.year + years, day=28)


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "--birth_day",
        "-b",
        type=str,
        default="",
        help="yyyymmddå½¢å¼ã§å…¥ã‚Œã¦ãã ã•ã„(ex. 20000101)",
        required=False,
    )
    parser.add_argument(
        "--limit_years",
        "-y",
        type=int,
        default=80,
        help="yyå½¢å¼ã§å…¥ã‚Œã¦ãã ã•ã„(ex. 80)",
        required=False,
    )
    args = parser.parse_args()
    date_format = "%Y/%m/%d"
    exec_date = datetime.now()
    try:
        birth_day = datetime.strptime(args.birth_day, "%Y%m%d")
    except ValueError as e:
        print(e)
        print("yyyymmddå½¢å¼ã§å…¥ã‚Œã¦ãã ã•ã„(ex. 20000101)")
    death_day = add_years(birth_day, args.limit_years)
    current_date = exec_date - birth_day
    current_month = monthmod(birth_day, exec_date)
    remaining_date = death_day - exec_date
    remaining_month = monthmod(exec_date, death_day)
    all_date = death_day - birth_day

    print(f"æƒ³å®šå¯¿å‘½: {args.limit_years}æ­³")
    print(f"æœ¬æ—¥: {exec_date.strftime(date_format)}")
    print(f"èª•ç”Ÿæ—¥: {birth_day.strftime(date_format)}")
    print(f"æƒ³å®šå¯¿å‘½: {death_day.strftime(date_format)}")
    print(f"æœ¬æ—¥ã¾ã§ã®çµŒéæ™‚é–“:\t{current_date.days*24}æ™‚é–“")
    print(f"æœ¬æ—¥ã¾ã§ã®çµŒéæ—¥æ•°:\t{current_date.days}æ—¥")
    print(f"æœ¬æ—¥ã¾ã§ã®çµŒéæœˆæ•°:\t{current_month[0].months}æœˆ")
    print(f"æœ¬æ—¥ã¾ã§ã®çµŒéå¹´æ•°:\t{current_month[0].months//12}å¹´")
    print(f"æƒ³å®šå¯¿å‘½ã¾ã§ã®æ®‹ã‚Šæ™‚é–“:\t{remaining_date.days*24}æ™‚é–“")
    print(f"æƒ³å®šå¯¿å‘½ã¾ã§ã®æ®‹ã‚Šæ—¥æ•°:\t{remaining_date.days}æ—¥")
    print(f"æƒ³å®šå¯¿å‘½ã¾ã§ã®æ®‹ã‚Šæœˆæ•°:\t{remaining_month[0].months}æœˆ")
    print(f"æƒ³å®šå¯¿å‘½ã¾ã§ã®æ®‹ã‚Šå¹´æ•°:\t{remaining_month[0].months//12}å¹´")
    print(f"çµŒéã—ãŸäººç”Ÿã®å‰²åˆ:\t{round((current_date/all_date)*100,2)}%")
    print(f"æ®‹ã‚Šã®äººç”Ÿã®å‰²åˆ:\t{round((remaining_date/all_date)*100,2)}%")


if __name__ == "__main__":
    main()
